#!/usr/bin/env bash

declare -i KEY
KEY=`xinput list | grep -Eio 'Caldigit, Inc.*.id\=[0-9]{1,2}' | grep -Eo '[0-9]{2}'`
declare -i STATE
STATE=`xinput list-props $KEY | grep 'Device Enabled' | awk '{print $4}'`
if [[ $STATE -eq 1 ]]; then
    echo "Docking laptop"
    # sets monitor stuff up for main monitor
    xrandr --output eDP-1 --mode 1920x1080 --rate 60 --pos 2560x180 --rotate normal --output DP-1-0 --primary --mode 2560x1440 --rate 144 --pos 0x0 --rotate normal --output DP-1-1 --off --output DP-1-2 --off --output DP-1-3 --off --output HDMI-1-0 --off --output DP-1-4 --off
    sleep 0.5
    # launches polybar config to get bar for every monitor
    bash ~/dotfiles/polybar/launch.sh &
    sleep 0.5
    i3-msg restart
else
    echo "Undocking laptop"
    xrandr --output eDP-1 --primary --mode 1920x1080 --rate 144 --pos 1284x154 --rotate normal --output DP-1-0 --off --output DP-1-1 --off --output DP-1-2 --off --output DP-1-3 --off --output HDMI-1-0 --off --output DP-1-4 --off
    sleep 0.5
    # relaunches polybar config
    bash ~/dotfiles/polybar/launch.sh &
    sleep 0.5
    i3-msg restart
fi
